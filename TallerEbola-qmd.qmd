---
title: "Estad√≠sticas y m√©todos para el an√°lisis de la respuesta a brotes."
subtitle: "D√≠a 2"
format: revealjs
editor: visual
---

## Agenda:

1.  Presentaci√≥n del equipo de talleristas

2.  Introducci√≥n a la biolog√≠a del virus del √âbola

3.  Taller

4.  Discusi√≥n

## Contexto:

-   La enfermedad apareci√≥ en **1976** en brotes casi simult√°neos en la Rep√∫blica **Democr√°tica del Congo (RDC)** y **Sud√°n del Sur**

-   Entre **1979 y 1994** no se detectaron casos ni brotes

-   Desde **1994 se han reconocido brotes** con una frecuencia cada vez mayor

-   El mayor brote hasta la fecha tuvo lugar en **√Åfrica Occidental** entre **marzo de 2014 y junio de 2016**

## Brotes del virusdel √©bola

![doi: 10.1038/s41572-020-0147-3.](TallerEbola-qmd_files/img/ebola_outbreaks.jpg)

# Instrucciones del taller en cada grupo (5min)

## Introducci√≥n

-   Esta pr√°ctica simula **la evaluaci√≥n temprana** y la **reconstrucci√≥n** de un **brote** de enfermedad por el **virus del √âbola (EVE).**

-   Introduce varios aspectos del an√°lisis de la etapa inicial de un brote, incluida la **probabilidad de muerte en los casos** (CFR por sus siglas en ingl√©s de Case Fatality Ratio), **curvas epidemiol√≥gicas**, **rastreo de contactos** y proyecciones de la **tasa de duplicaci√≥n** de los casos y el **n√∫mero reproductivo instant√°neo** (Rt).

## Objetivos

<font size="6">

-   Identificar los par√°metros necesarios en casos de¬† transmisi√≥n de enfermedades infecciosas de persona a persona.¬†

-   Estimar e interpretar la tasa de crecimiento y el tiempo en que se duplica la epidemia.

-   Estimar el intervalo serial a partir de los datos pareados de individuos infectantes e individuos infectados.¬†

-   Estimar e interpretar el n√∫mero de reproducci√≥n instant√°neo¬† de la epidemia

-   Estimar la tasa de letalidad (CFR)

-   Calcular y graficar la incidencia

</font>

## Conceptos b√°sicos a desarrollar:

-   Transmisi√≥n de enfermedades infecciosas de persona a persona

-   Intervalo serial

-   N√∫mero reproductivo efectivo

-   Radio de letalidad (IFR, CFR)

-   Tasa de crecimiento y duplicaci√≥n

-   Incidencia

# Situaci√≥n a analizar

## Un nuevo brote de EVE en un pa√≠s ficticio de √Åfrica occidental

<br>

Se ha notificado un nuevo brote de EVE en un pa√≠s ficticio de √Åfrica occidental.¬†

<br>

El Ministerio de Salud se encarga de coordinar la respuesta al brote, y lo ha contratado a usted como consultor en an√°lisis epid√©mico para informar la respuesta en tiempo real.

## Al inicio del brote

::: columns
::: {.column width="70%"}
![https://www.reconlearn.org/post/outbreakstatsprimer.html](TallerEbola-qmd_files/img/inicio_del_brote.png)
:::

::: {.column width="30%"}
An√°lisis r√°pido de la situaci√≥n para orientar la toma de decisiones

<br><br>

**¬øQu√© datos necesito?**
:::
:::

## Datos m√≠nimos necesarios usuales en epidemias nuevas

-   Fecha de inicio de s√≠ntomas: date of onset

-   Fecha de exposici√≥n/infecci√≥n: infection date

-   Fecha del desenlace (recuperaci√≥n, muerte): outcome date

-   Datos generales de individuo: edad, g√©nero, ocupaci√≥n, etc

-   Datos de brotes anteriores

## Al inicio del brote

::: columns
::: {.column width="70%"}
![https://www.reconlearn.org/post/outbreakstatsprimer.html](TallerEbola-qmd_files/img/inicio_del_brote.png)
:::

::: {.column width="30%"}
An√°lisis r√°pido de la situaci√≥n para orientar la toma de decisiones

<br><br>

**¬øQu√© preguntas surgen inmediatamente?**
:::
:::

## **Al inicio de una epidemia**

Se requieren datos para **planear la respuesta:**

-   ¬øQu√© tan r√°pido crece una epidemia?

-   ¬øCu√°l es el riesgo de muerte?

-   ¬øCu√°ntos casos puedo esperar en los pr√≥ximos d√≠as?

-   ¬øCu√°nta capacidad hospitalaria y del sistema de salud requeriremos en los pr√≥ximos d√≠as?

# Pasemos a R üë©‚Äçüíªüë®‚Äçüíª

## Instrucciones

-   En su carpeta "**Taller-Params-Ebola**" abra el archivo llamado **Taller-Params-Ebola.Rproj**

-   Verifique que tiene una carpeta llamada **data** con dos archivos:¬†

    -   linelist_clean.rds¬†

    -   contacts_20140701.xlsx

-   Abra el script llamado **script-Ebola.R**

## Instrucciones:

-   Cargue las librer√≠as necesarias:

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
library(tidyverse) # read_rds, ggplot2
library(readxl) # read_excel | tidyverse
library(binom) # binom.confint
library(knitr) # kable
library(incidence) # incidence, fit
library(epicontacts)# make_epicontacts, epicontacts
library(epitrix) # fit_disc_gamma
library(EpiEstim) # make_config, estimate_R
```

## Instrucciones

-   Cargue las bases de datos:

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
linelist_clean <- read_rds("data/linelist_clean.rds")
contacts <- read_excel("data/contacts_20140701.xlsx", na = c("", "NA"))
```

-   T√≥mese su tiempo para mirar los datos y la estructura

```{r echo=TRUE, message=FALSE, results=FALSE, warning=FALSE,comment=""}
str(contacts)
str(linelist_clean)
```

## Estructura de los datos:

::: columns
::: {.column width="50%"}
```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
str(contacts)
```
:::

::: {.column width="50%"}
```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
str(linelist_clean)
```
:::
:::

<font size="5">

-   ¬ø Son los datos y el formato similares a bases de datos de casos que ha visto en el pasado?

-   ¬øQu√© otra informaci√≥n le gustar√≠a recopilar?

</font>

## Probabilidad de muerte en los casos (CFR)

![https://www.reconlearn.org/post/outbreakstatsprimer.html](TallerEbola-qmd_files/img/CFR_pie.png)

## Instrucciones

<font size="5">

::: columns
::: {.column width="55%"}
```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
table(linelist_clean$outcome, useNA = "ifany")
```
:::

::: {.column width="45%"}
¬øC√≥mo calcular√≠a el CFR a partir de esto?

Piense en qu√© hacer con los casos cuyo resultado es \`NA\`
:::
:::

::: columns
::: {.column width="65%"}
```{r echo=TRUE, message=FALSE, warning=FALSE,comment="", results=FALSE}
n_dead <- sum(linelist_clean$outcome %in% "Death")
n_known_outcome <- sum(linelist_clean$outcome %in% c("Death", "Recover"))
cfr <- n_dead / n_known_outcome
cfr_with_CI <- binom.confint(n_dead, n_known_outcome, method = "exact")
kable(cfr_with_CI, caption = "cfr_with_CI")
```
:::

::: {.column width="35%"}
C√°lculo de CFR
:::
:::

::: columns
::: {.column width="65%"}
```{r echo=FALSE, message=FALSE, warning=FALSE,comment=""}
n_dead <- sum(linelist_clean$outcome %in% "Death")
n_known_outcome <- sum(linelist_clean$outcome %in% c("Death", "Recover"))
cfr <- n_dead / n_known_outcome
cfr_with_CI <- binom.confint(n_dead, n_known_outcome, method = "exact")
kable(cfr_with_CI, caption = "cfr_with_CI")
```
:::

::: {.column width="35%"}
¬øC√≥mo interpreta estos resultados?
:::
:::

</font>

## **No confundir CFR con IFR**

-   **CFR:** Es la proporci√≥n de casos reportados que mueren a causa de la infecci√≥n

    $\rightarrow$ <font size="5"> CFR se puede calcular con los datos de vigilancia epidemiol√≥gica </font>

<br>

-   **IFR:** Es la proporci√≥n de infecciones (detectadas y no detectadas) que mueren a causa de la infecci√≥n

    $\rightarrow$ <font size="5"> IFR s√≥lo se puede calcular con datos de vigilancia epidemiol√≥gica + informaci√≥n adicional como estudios prevalencia </font>

## Incidencia

**N√∫mero de casos nuevos en un per√≠odo de tiempo determinado**

-   Se basa en las fechas, por lo general de inicio de los s√≠ntomas.

-   Se afecta por los **rezagos de reporte** (e.g. quienes iniciaron s√≠ntomas ayer s√≥lo van a ser reportados algunos d√≠as despu√©s)

## Incidencia

**Miremos las curvas de incidencia**

-   El primer paso del an√°lisis es descriptivo: **queremos dibujar una epicurva o curva epidemiol√≥gica**. Esto permite visualizar la incidencia a lo largo del tiempo por fecha de inicio de los s√≠ntomas.

-   La primera pregunta que queremos responder es:¬† **¬øqu√© tan grave es la situaci√≥n?**

## Incidencia

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
i_daily <- incidence(linelist_clean$date_of_onset)
i_daily
```

<center>**¬øQu√© observa?**</center>

## Incidencia diaria seg√∫n fecha de inicio de s√≠ntomas

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
plot(i_daily, border = "black")
```

## Pregunta

### ¬øCu√°l es la mejor clasificaci√≥n de la epidemia a partir de la informaci√≥n de la curva epid√©mica?

A. Fuente com√∫n puntual

B. Fuente com√∫n continua

C. Fuente com√∫n intermitente

D. Propagada (persona a persona)

## Pregunta

### Su jefe le pregunta, ¬øen qu√© fecha inici√≥ s√≠ntomas el primer caso (caso i√≠ndice)?

Usted dir√≠a que fue...

```{r echo=FALSE, message=FALSE, warning=FALSE,comment=""}
plot(i_daily, border = "black")
```

## Instrucciones

-   Otro problema es que **puede ser dif√≠cil interpretar las tendencias al observar la incidencia diaria**

-   Calcule y grafique la incidencia semanal **i_weekly**

```{r echo=TRUE, message=FALSE, warning=FALSE,comment="", results=FALSE}
i_weekly <- incidence(linelist_clean$date_of_onset, interval = 7, 
                      last_date = as.Date(max(linelist_clean$date_of_hospitalisation, na.rm = TRUE)))
i_weekly
```

## Incidencia semanal

::: columns
::: {.column width="40%"}
```{r echo=FALSE, message=FALSE, warning=FALSE,comment=""}
i_weekly <- incidence(linelist_clean$date_of_onset, interval = 7, 
                      last_date = as.Date(max(linelist_clean$date_of_hospitalisation, na.rm = TRUE)))
i_weekly
```
:::

::: {.column width="60%"}
```{r echo=FALSE, message=FALSE, warning=FALSE,comment=""}
plot(i_weekly, border = "black")
```

**¬øQu√© opina de esta nueva gr√°fica?**
:::
:::

## Estimaci√≥n de la tasa de crecimiento mediante un modelo¬† log-lineal

-   Es probablemente el **modelo de incidencia m√°s simple**

-   **Modelo de regresi√≥n lineal sobre incidencias transformadas logar√≠tmicamente**

-   Para ello trabajaremos con **incidencia semanal**, para evitar tener demasiados problemas con incidencia cero (que no se pueden registrar).

## <font size=14>Curva epid√©mica con modelo log lineal</font>

![https://www.reconlearn.org/post/outbreakstatsprimer.html](TallerEbola-qmd_files/img/curv_epi_loglineal.png)

<font size="5.5">

$$
\left.
\begin{matrix}
y:\text{n√∫mero de casos incidentes} \\
r:\text{tasa de crecimiento} \\
\beta_0: \text{intercepto}
\end{matrix}
\right\} \log(y) = \beta_0 + rt + \epsilon \Rightarrow \hat{y} = \exp^{rt+\beta_0}
$$

</font>

## <font size=14>Curva epid√©mica con modelo log lineal</font>

::: columns
::: {.column width="30%"}
<font size="5">

-   Grafique la incidencia transformada logar√≠tmicamente

<!-- -->

-   ¬øQu√© le dice esta gr√°fica sobre la epidemia?

</font>

![](TallerEbola-qmd_files/img/curv_epi_exp.png)
:::

::: {.column width="70%"}
```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
ggplot(as.data.frame(i_weekly)) + 
  geom_point(aes(x = dates, y = log(counts))) + 
  scale_x_incidence(i_weekly) +
  xlab("date") +
  ylab("log weekly incidence") + 
  theme_minimal()
```
:::
:::

## <font size=14>Curva epid√©mica con modelo log lineal</font>

#### Ajuste un modelo log-lineal a los datos de incidencia

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
f <- incidence::fit(i_weekly)
f
```

<center>**¬øQu√© le dicen estos datos?**</center>

## <font size=14>Curva epid√©mica con modelo log lineal</font>

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
plot(i_weekly, fit = f)
```

<center><font size="6">Mirando la gr√°fica y el ajuste, **¬øcree que este es un ajuste razonable?**</font></center>

## Instrucciones

-   Utilizando la gr√°fica del logaritmo (incidencia) que grafic√≥ anteriormente, y pensando en por qu√© el crecimiento exponencial no puede observarse en las √∫ltimas semanas**, elija una fecha l√≠mite** y **ajuste el modelo logar√≠tmico lineal** a una secci√≥n adecuada de la epicurva donde crea que puede estimar de manera m√°s confiable la tasa de crecimiento r, y el tiempo de duplicaci√≥n.

-   Es posible que desee examinar **cu√°nto tiempo despu√©s de la aparici√≥n de los s√≠ntomas los casos son hospitalizados**

## <font size=14>Curva epid√©mica con modelo log lineal</font>

#### ¬øCu√°ntas semanas debe descartar al final de la epicurva?

-   Trunca la incidencia semanal seg√∫n las semanas descartadas

    ```{r echo=TRUE, message=FALSE, warning=FALSE,comment="", results=FALSE}
    n_weeks_to_discard <- 2
    min_date <- min(i_daily$dates)
    max_date <- max(i_daily$dates) - n_weeks_to_discard * 7
    # Para truncar la incidencia semanal 
    i_weekly_trunc <- subset(i_weekly, 
                             from = min_date, 
                             to = max_date) # descarte las √∫ltimas semanas de datos
    # incidencia diaria truncada.
    #No la usamos para la regresi√≥n lineal pero se puede usar m√°s adelante
    i_daily_trunc <- subset(i_daily, 
                             from = min_date, 
                             to = max_date) # eliminamos las √∫ltimas dos semanas de datos
    ```

## <font size=14>Curva epid√©mica con modelo log lineal</font>

<font size="6">

Vuelva a montar y a graficar el modelo logar√≠tmico lineal, pero utilizando los datos truncados **i_weekly_trunc**.

::: columns
::: {.column width="40%"}
```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
f <- incidence::fit(i_weekly_trunc)
f
```
:::

::: {.column width="60%"}
```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
plot(i_weekly_trunc, fit = f)
```

<center>Mirando la gr√°fica y el ajuste, **¬øcree que este es un ajuste m√°s razonable comparado con el anterior?**</center>
:::
:::

</font>

## <font size=14>Curva epid√©mica con modelo log lineal</font>

#### Observe las estad√≠sticas resumidas de su ajuste:

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
summary(f$model)
```

<center>**¬øEl modelo se ajusta bien a los datos?**</center>

## <font size=14>Curva epid√©mica con modelo log lineal</font>

#### Estimacion de la tasa de crecimiento

¬øCu√°l es la tasa de crecimiento estimada de la epidemia?, ¬øC√≥mo lo interpreta?

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
daily_growth_rate <- f$model$coefficients['dates.x']
daily_growth_rate
# intervalo de confianza:
daily_growth_rate_CI <- confint(f$model, 'dates.x', level=0.95)
daily_growth_rate_CI
```

## Tiempo de duplicaci√≥n

::: columns
::: {.column width="60%"}
<font size="5"> [![https://www.reconlearn.org/post/outbreakstatsprimer.html](TallerEbola-qmd_files/img/doubling_time_scheme.png)](https://www.reconlearn.org/post/outbreakstatsprimer.html)

$$
\left.
\begin{matrix}
y:\text{n√∫mero de casos incidentes} \\
r:\text{tasa de crecimiento} \\
\beta_0: \text{intercepto}
\end{matrix}
\right\} \hat{y} = \exp^{rt + \beta_0}
$$

</font>
:::

::: {.column width="40%"}
$T$ es el tiempo que le toma a la curva epid√©mica para **duplicarse:**

$$  \hat{y}_2 = 2\hat{y}_1 \\ 2 = \frac{\hat{y}_2}{\hat{y}_1} = \frac{\exp^{rt_2 + \beta_0}}{\exp^{rt_1 + \beta_0}} \\ 2 = \exp^{r(t_2-t_1)} = \exp^{rT}\\ \Rightarrow T = \frac{\log(2)}{r} $$
:::
:::

## Tiempo de duplicaci√≥n

¬ø Cu√°l es el **tiempo de duplicaci√≥n** estimado de la epidemia?,

¬øC√≥mo lo interpreta?

```{r eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE,comment=""}
doubling_time_days <- log(2) / daily_growth_rate
doubling_time_days 
# intervalo de confianza:
doubling_time_days_CI <- log(2) / rev(daily_growth_rate_CI)
doubling_time_days_CI
```

## <font size=14>Generar red de contactos con epicontacts</font>

<font size="6.5">

**El rastreo de contactos es uno de los pilares de la respuesta a un brote.**

#### Procedimientos claves:

-   **Definir tiempo de rastreo:** para el ejemplo de √©bola se vigilan durante 21 d√≠as (el l√≠mite superior del per√≠odo de incubaci√≥n)

-   **Definir base de datos a usar:** para el ejemplo base de datos completa o base inicial

-   **Paquete a usar:** "epicontacts"

-   **Funci√≥n y argumentos:**

    -   **make_epicontacts()**

</font>

## <font size=14>Generar red de contactos con epicontacts</font>

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
epi_contacts <- make_epicontacts(linelist_clean, 
                                 contacts, 
                                 id = "case_id",
                                 from = "infector",
                                 to = "case_id")
epi_contacts
```

## <font size=14>Generar red de contactos con epicontacts</font>

Usted puede graficar f√°cilmente estos contactos, pero con un poco de ajuste (ver **?vis_epicontacts**). Puede personalizar, por ejemplo, s√≠mbolos por g√©nero y colores de flechas por fuente de exposici√≥n (u otras variables de inter√©s):

```{r table_contact_type}
# observe la fuente de infecci√≥n reportada de los contactos.
table(epi_contacts$contacts$source, useNA = "ifany")
```

## Red de contactos

```{r plot_contacts, eval = TRUE}
p <- plot(epi_contacts, node_shape = "gender", shapes = c(m = "male", f = "female"), node_color = "gender", edge_color = "source", selector = FALSE)
p
```

## Instrucciones

-   Usando la funci√≥n **match** ( ver **?match** ) verifique que los contactos visualizados sean realmente casos.

```{r check_contact_cases}
match(contacts$case_id, linelist_clean$case_id)
```

-   Una vez se asegure de que todos estos son casos, mire la red: ¬øParece que hay superpropagaci√≥n (transmisi√≥n heterog√©nea)?

## Modelo de proceso de ramificaci√≥n

-   La transmisibilidad de la enfermedad puede evaluarse mediante la **estimaci√≥n del n√∫mero de reproducci√≥n (R)**, definido como el n√∫mero esperado de casos secundarios por caso infectado.

-   ¬†En las primeras etapas de un brote, y asumiendo una gran poblaci√≥n sin inmunidad, esta cantidad corresponde al **n√∫mero de reproducci√≥n b√°sico¬† R(0)** es decir, en una gran poblaci√≥n totalmente susceptible.

## Modelo de proceso de ramificaci√≥n

-   El paquete **EpiEstim** implementa una **estimaci√≥n bayesiana del n√∫mero reproductivo**, utilizando las fechas de inicio de los s√≠ntomas y la distribuci√≥n del intervalo serial

-   Descripci√≥n de **la incidencia en un d√≠a** dado como la distribuci√≥n de Poisson, con una **media determinada por la fuerza total de infecci√≥n en ese d√≠a**:

$$
I_t \sim Poisson(\lambda_t)
$$

## Modelo de proceso de ramificaci√≥n

-   Teniendo en cuenta¬† que $R_t$ es el n√∫mero de reproducci√≥n y $w$ la distribuci√≥n del intervalo serial discreta, la **fuerza de infecci√≥n** se define como:

$$
\lambda_t = R_t \sum_{s=1}^{t} I_s w_{t-s}
$$

## Verosimilitud (Likelihood)

Una medida relativa de ajuste entre los datos y el modelo. Se define como una funci√≥n de R:

![https://www.reconlearn.org/slides/outbreak-statistics/outbreak-statistics#19](TallerEbola-qmd_files/img/likelihood_reminder.png)

## Estimaci√≥n del intervalo serial

![https://www.reconlearn.org/slides/outbreak-statistics/outbreak-statistics#16](TallerEbola-qmd_files/img/serial_interval_toon.png)

## <font size="10">Ajustar una distribuci√≥n discreta al intervalo serial </font>

-   **Funci√≥n y argumentos:**

    -   **get_pairwise(), argumentos relevantes "x" y "attribute" los cuales corresponden a la base y a la variable que contenga las fechas para el c√°lculo de intervalos.**

<!-- -->

-   Posteriormente puedes graficar la frecuencia que hay del n√∫mero de d√≠as, y observar la distribuci√≥n emp√≠rica que sigue.

## <font size="10">Ajustar una distribuci√≥n discreta al intervalo serial </font>

-   Dado que los **datos se recopilaron sobre pares de individuos infecciosos e infectados**, esto deber√≠a ser suficiente para estimar la distribuci√≥n del intervalo¬† serial

<!-- -->

-   **Si ese no fuera el caso, que hubiera hecho para obtener esta estimaci√≥n?**

-   Utilice la funci√≥n **get_pairwise** para extraer el intervalo serial

## <font size="10">Ajustar una distribuci√≥n discreta al intervalo serial </font>

-   Utilice la funci√≥n **get_pairwise** para extraer el intervalo serial

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
si_obs <- get_pairwise(epi_contacts, "date_of_onset")
summary(si_obs)
```

## <font size="10">Ajustar una distribuci√≥n discreta al intervalo serial </font>

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
hist(si_obs, breaks = 0:30,
     xlab = "D√≠as despu√©s de la aparici√≥n de los s√≠ntomas", ylab = "Frecuencia",
     main = "intervalo serial (distribuci√≥n emp√≠rica)",
     col = "grey", border = "white")
```

<center>**¬øQu√© opina de esta distribuci√≥n?**</center>

## <font size="10">Ajustar una distribuci√≥n discreta al intervalo serial </font>

Estas distribuciones adem√°s **pueden ajustarse a varios modelos param√©tricos, siendo el m√°s frecuente el modelo gamma**, de la siguiente forma:

-   **Funci√≥n y argumentos:**

    -   **fit_disc_gamma(x),** donde x corresponde a las observaciones de los intervalos seriales

## Ajuste a distribucion gamma

::: columns
::: {.column width="40%"}
<font size="5">Use la funci√≥n fit_disc_gamma del paquete epitrix para ajustar estos datos a una distribuci√≥n Gamma de valores discretos </font>

<br>

<center>**¬øC√≥mo interpreta estos hallazgos?**</center>
:::

::: {.column width="60%"}
<font size="5">

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
si_fit <- fit_disc_gamma(si_obs, w = 1)
si_fit
```

</font>
:::
:::

## Ajuste a distribucion gamma

**si_fit** contiene informaci√≥n diversa sobre los retrasos ajustados, incluida la distribuci√≥n estimada.¬†

Puede comparar esta distribuci√≥n con los datos emp√≠ricos en la siguiente tabla:

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
si <- si_fit$distribution
si
```

## Ajuste a distribucion gamma

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
## compare fitted distribution
hist(si_obs, xlab = "D√≠as despu√©s de la aparici√≥n de los s√≠ntomas", ylab = "Frecuencia",
     main = "intervalo serial: ajustar a los datos", col = "salmon", border = "white",
     50, ylim = c(0, 0.15), freq = FALSE, breaks = 0:35)
points(0:60, si$d(0:60), col = "#9933ff", pch = 20)
points(0:60, si$d(0:60), col = "#9933ff", type = "l", lty = 2)
```

## Estimaci√≥n del n√∫mero reproductivo instant√°neo (Rt)

-   Cuando la suposici√≥n de que (R) es constante en el tiempo se vuelve insostenible, **una alternativa es estimar la transmisibilidad variable en el tiempo utilizando el n√∫mero de reproducci√≥n instant√°nea (Rt).**

-   Este enfoque se implementa en el paquete \`EpiEstim.\`¬†

-   Estima (Rt) para ventanas de tiempo personalizadas (el valor predeterminado es una **sucesi√≥n de ventanas de tiempo deslizantes), utilizando la probabilidad de Poisson**

## Estimaci√≥n del n√∫mero reproductivo instant√°neo (Rt)

A continuaci√≥n, estimamos la transmisibilidad para ventanas de tiempo deslizantes de 1 semana (el valor predeterminado de **estimate_R**):

<font size="5">

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
config <- make_config(mean_si = si_fit$mu, # media de la distribuci√≥n si estimada anteriormente
                      std_si = si_fit$sd,  # desviaci√≥n est√°ndar de la distribuci√≥n si estimada anteriormente
                      t_start = 2,         # d√≠a de inicio de la ventana de tiempo
                      t_end = length(i_daily_trunc$counts)) # √∫ltimo d√≠a de la ventana de tiempo
```

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
config = make_config(list(mean_si = si_fit$mu, std_si = si_fit$sd))  
# t_start y t_end se configuran autom√°ticamente para estimar R en ventanas deslizantes para 1 semana de forma predeterminada.
```

</font>

## Estimacion del n√∫mero reproductivo instant√°neo (Rt)

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
# use estimate_R using method = "parametric_si"
Rt <- estimate_R(i_daily_trunc, method = "parametric_si", 
                           si_data = si_data,
                           config = config)
# mire las estimaciones de Rt m√°s recientes:
tail(Rt$R[, c("t_start", "t_end", "Median(R)", 
             "Quantile.0.025(R)", "Quantile.0.975(R)")])
```

## Estimacion del n√∫mero reproductivo instant√°neo (Rt)

```{r echo=TRUE, message=FALSE, warning=FALSE,comment=""}
plot(Rt, legend = FALSE)
```

<center>**¬øC√≥mo interpretar√≠a este resultado?**</center>

# Hemos llegado a la meta... <br> ¬°Gracias!
